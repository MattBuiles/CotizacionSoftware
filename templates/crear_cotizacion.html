<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Editar Cotización - IPB SAS' if cotizacion else 'Crear Cotización - IPB SAS' }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        function toggleProductService() {
            const selectedOption = document.getElementById("producto_servicio").value;
            const productoGroup = document.getElementById("producto-group");
            const servicioGroup = document.getElementById("servicio-group");
            const additionalFields = document.getElementById("additional-fields");

            if (selectedOption === "producto") {
                productoGroup.style.display = "block";
                servicioGroup.style.display = "none";
                additionalFields.style.display = "block";
            } else if (selectedOption === "servicio") {
                productoGroup.style.display = "none";
                servicioGroup.style.display = "block";
                additionalFields.style.display = "block";
            } else {
                productoGroup.style.display = "none";
                servicioGroup.style.display = "none";
                additionalFields.style.display = "none";
            }
        }

        window.onload = function() {
            toggleProductService(); // Initial toggle based on pre-filled values
        }
    </script>
</head>
<body>
    <header>
        <h1>{{ 'Editar Cotización' if cotizacion else 'Crear Cotización' }}</h1>
    </header>
    <main>
        <form action="/ver_cotizacion" method="post" class="consignation-form">
            <!-- Campo oculto para ID de cotización si estamos editando -->
            {% if cotizacion %}
                <input type="hidden" name="cotizacion_id" value="{{ cotizacion.id }}">
            {% endif %}

            <!-- Selección de Producto o Servicio -->
            <div class="form-group">
                <label for="producto_servicio">Producto o Servicio</label>
                <select id="producto_servicio" name="producto_servicio" required onchange="toggleProductService()">
                    <option value="">Selecciona una opción</option>
                    <option value="producto" {% if cotizacion and cotizacion.producto %}selected{% endif %}>Producto</option>
                    <option value="servicio" {% if cotizacion and not cotizacion.producto %}selected{% endif %}>Servicio</option>
                </select>
            </div>

            <!-- Campos específicos de Producto -->
            <div class="form-group" id="producto-group">
                <label for="producto">Producto</label>
                <select id="producto" name="producto">
                    <option value="impermeabilizacion" {% if cotizacion and cotizacion.producto == 'impermeabilizacion' %}selected{% endif %}>Impermeabilización</option>
                    <option value="obra_civil" {% if cotizacion and cotizacion.producto == 'obra_civil' %}selected{% endif %}>Obra Civil</option>
                    <option value="ingenieria_agua" {% if cotizacion and cotizacion.producto == 'ingenieria_agua' %}selected{% endif %}>Ingeniería del Agua</option>
                </select>
            </div>

            <!-- Campos específicos de Servicio -->
            <div class="form-group" id="servicio-group">
                <label for="servicio">Servicio</label>
                <input type="text" id="servicio" name="servicio" value="{{ cotizacion.servicio if cotizacion else '' }}">
            </div>

            <!-- Campos adicionales -->
            <div id="additional-fields">
                <div class="form-group">
                    <label for="ciudad">Ciudad</label>
                    <input type="text" id="ciudad" name="ciudad" value="{{ cotizacion.ciudad if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="empresa_cliente_nombre">Nombre de la Empresa Cliente</label>
                    <input type="text" id="empresa_cliente_nombre" name="empresa_cliente_nombre" value="{{ cotizacion.empresa_cliente_nombre if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="cliente_nombre">Nombre del Cliente</label>
                    <input type="text" id="cliente_nombre" name="cliente_nombre" value="{{ cotizacion.cliente_nombre if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="cliente_celular">Celular del Cliente</label>
                    <input type="text" id="cliente_celular" name="cliente_celular" value="{{ cotizacion.cliente_celular if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="cliente_correo">Correo del Cliente</label>
                    <input type="email" id="cliente_correo" name="cliente_correo" value="{{ cotizacion.cliente_correo if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="nombre_proyecto">Nombre del Proyecto</label>
                    <input type="text" id="nombre_proyecto" name="nombre_proyecto" value="{{ cotizacion.nombre_proyecto if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="plazo_oferta">Plazo de la Oferta</label>
                    <input type="text" id="plazo_oferta" name="plazo_oferta" value="{{ cotizacion.plazo_oferta if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="tiempo_entrega">Tiempo de Entrega</label>
                    <input type="text" id="tiempo_entrega" name="tiempo_entrega" value="{{ cotizacion.tiempo_entrega if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="porcentaje_anticipo">Porcentaje de Anticipo</label>
                    <input type="number" id="porcentaje_anticipo" name="porcentaje_anticipo" value="{{ cotizacion.porcentaje_anticipo if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="porcentaje_primera_acta">Porcentaje Primera Acta</label>
                    <input type="number" id="porcentaje_primera_acta" name="porcentaje_primera_acta" value="{{ cotizacion.porcentaje_primera_acta if cotizacion else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="porcentaje_acta_final">Porcentaje Acta Final</label>
                    <input type="number" id="porcentaje_acta_final" name="porcentaje_acta_final" value="{{ cotizacion.porcentaje_acta_final if cotizacion else '' }}" required>
                </div>
            </div>

            <button type="submit" class="btn">{{ 'Editar Cotización' if cotizacion else 'Crear Cotización' }}</button>
        </form>
    </main>
    <footer>
        <a href="/" class="support-link">Volver al Inicio</a>
    </footer>
</body>
</html>
