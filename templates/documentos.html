<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentos del Proyecto {{ cotizacion.proyecto }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>Documentos del Proyecto {{ cotizacion.proyecto }}</h1>
    </header>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul class="flashes">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- Filtro por tipo de documento -->
    <div class="filters">
        <label for="tipoFiltro">Filtrar por tipo de documento:</label>
        <select id="tipoFiltro" onchange="filtrarTipo()">
            <option value="">Todos</option>
            <option value="pdf">PDF</option>
            <option value="png">PNG</option>
            <option value="jpg">JPG</option>
            <option value="docx">DOCX</option>
        </select>
    </div>

    <!-- Formulario para reemplazar archivo -->
    <div class="form-container">
        <h2>Reemplazar un archivo</h2>
        <form action="{{ url_for('reemplazar_archivo') }}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="cotizacion_id" value="{{ cotizacion.id }}">
            <label for="nombreArchivoReemplazar">Archivo a reemplazar:</label>
            <select id="nombreArchivoReemplazar" name="nombreArchivoReemplazar" required>
                <!-- Opción vacía -->
                <option value="" disabled selected>Seleccionar archivo...</option>
                {% for documento in documentos %}
                    <option value="{{ documento.nombre }}">{{ documento.nombre }}</option>
                {% endfor %}
            </select>
            <input type="file" name="archivoNuevo" required>
            <input type="submit" value="Reemplazar archivo">
        </form>
    </div>

    <!-- Formulario para eliminar archivo -->
    <div class="form-container">
        <h2>Eliminar un archivo</h2>
        <form action="{{ url_for('eliminar_archivo') }}" method="post">
            <input type="hidden" name="cotizacion_id2" value="{{ cotizacion.id }}">
            <label for="nombreArchivoEliminar">Archivo a eliminar:</label>
            <select id="nombreArchivoEliminar" name="nombreArchivoEliminar" required>
                <!-- Opción vacía -->
                <option value="" disabled selected>Seleccionar archivo...</option>
                {% for documento in documentos %}
                    <option value="{{ documento.nombre }}">{{ documento.nombre }}</option>
                {% endfor %}
            </select>
            <input type="submit" value="Eliminar archivo">
        </form>
    </div>

    <!-- Lista de documentos -->
    <ul id="documentosLista">
        {% for documento in documentos %}
        <li class="documento-item" data-tipo="{{ documento.nombre.split('.')[-1] }}">
            <a href="{{ documento.url }}" target="_blank">{{ documento.nombre }}</a>
        </li>
        {% endfor %}
    </ul>

    <footer>
        <a href="{{ url_for('lista_proyectos') }}">Volver a la Lista de Proyectos</a>
    </footer>

    <script>
        function filtrarTipo() {
            var tipoSeleccionado = document.getElementById("tipoFiltro").value;
            var documentos = document.getElementsByClassName("documento-item");

            for (var i = 0; i < documentos.length; i++) {
                var tipoDocumento = documentos[i].getAttribute("data-tipo");
                if (tipoSeleccionado === "" || tipoSeleccionado === tipoDocumento) {
                    documentos[i].style.display = "";
                } else {
                    documentos[i].style.display = "none";
                }
            }
        }
    </script>
</body>
</html>
